# Packages used by our ubuntu base, adapted from:
#  https://github.com/GoogleContainerTools/rules_distroless/blob/2ce7b477def75579c49bab25266f953f30275c88/examples/ubuntu_snapshot/BUILD.bazel
#
#  Anytime this file is changed, the lockfile needs to be regenerated. See MODULE
#  for instructions.
version: 1

# Various channels used to pull packages from
sources:
  - channel: noble main
    url: https://snapshot.ubuntu.com/ubuntu/20240923T000000Z
  - channel: noble universe
    url: https://snapshot.ubuntu.com/ubuntu/20240923T000000Z
  - channel: noble-security main
    url: https://snapshot.ubuntu.com/ubuntu/20240923T000000Z
  - channel: noble-updates main
    url: https://snapshot.ubuntu.com/ubuntu/20240923T000000Z

archs:
  - "amd64"

packages:
  - "apt"
  - "bash"
  - "ca-certificates"
  - "coreutils" # for chmod
  - "dosfstools"
  - "dpkg" # for apt list --installed
  - "gawk" # for build-bootstrap-config-image
  - "gzip" # for tar-ing up ic regsitry store in systests
  - "libssl3t64"
  - "libunwind8"
  - "mtools"
  - "openssh-client" # used to SSH into image
  - "perl"
  - "rsync"
  - "tar"
  - "zstd"

  # This defines all Ubuntu packages to be installed on the target image. The
  # packages here are intended to be the bare minimum required for replica
  # operation for the "prod" image. Please put debugging / dev
  # utilities into packages.dev, these will then be available on the dev
  # image only.

  # Need kernel to boot anything
  - "linux-image-virtual-hwe-24.04"
  - "initramfs-tools"

  # Need systemd for boot process
  - "systemd"
  - "systemd-sysv"
  - "systemd-journal-remote"
  - "systemd-resolved"

  # Third-party services we will be running
  - "chrony"
  - "openssh-server"

  # Runtime libraries for replica
  - "liblmdb0"
#  - "libunwind8"
  - "libselinux1"

  # Smartcard support for replica
  - "pcsc-tools"
  - "pcscd"
  - "opensc"

  # Required system setup tools
  - "attr"
#  - "ca-certificates"
  - "cryptsetup"
  - "curl"
  - "faketime"
  - "fdisk"
  - "iproute2"
  - "isc-dhcp-client"
  - "jq"
  - "less"
  - "lvm2"
  - "net-tools"
  - "nftables"
  - "parted"
#  - "rsync"
  - "sudo"
  - "sysfsutils"
  - "udev"
  - "usbutils"
  - "xfsprogs"
#  - "zstd"

  # This is unclear -- why is this here? This should "probably" be dev tool.
  - "protobuf-compiler"

  # SELinux support
  - "selinux-policy-default"
  - "selinux-utils"
  - "semodule-utils"
  - "policycoreutils"
  # this is required for policy building -- presently policy modules are built
  # inside the target which is not fully proper. When the build is moved out,
  # this package can be removed
  - "selinux-policy-dev"
  - "checkpolicy"
