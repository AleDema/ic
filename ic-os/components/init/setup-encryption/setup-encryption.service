[Unit]
Description=Set up and activate encrypted storage
DefaultDependencies=no
# When SEV is disabled, the key is read from /boot/config.
# When SEV is enabled, the key is read from /var during the first boot after an upgrade.
RequiresMountsFor=/boot/config /var
# TODO: Requires copying config.json
Before=cryptsetup-pre.target
Wants=cryptsetup-pre.target

[Install]
WantedBy=local-fs.target

[Service]
Type=oneshot
RemainAfterExit=true
ExecStart=/opt/ic/bin/setup-encryption.sh
