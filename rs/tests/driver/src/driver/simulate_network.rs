//! This module contains functionality to simulate a subnet's
/// network, RTT and Packet Loss, during system tests.
use super::{
    super::{driver::test_env_api::SshSession, util::get_config},
    test_env_api::{IcNodeContainer, SubnetSnapshot},
};
use std::{time::Duration, vec::Vec};

pub trait SimulateNetwork<NetworkSettings> {
    fn apply_network_settings(&self, network_settings: NetworkSettings);
}

impl SimulateNetwork<ProductionSubnetTopology> for SubnetSnapshot {
    fn apply_network_settings(&self, network_settings: ProductionSubnetTopology) {
        let nodes: Vec<_> = self.nodes().collect();

        assert_eq!(
            nodes.len(),
            network_settings.subnet_size(),
            "Subnet size must match the size of the simulated topology."
        );

        let subnet_size = network_settings.subnet_size();
        let mut tc_commands = Vec::<String>::with_capacity(subnet_size);

        let packet_loss = network_settings.packet_loss();
        let rtt = network_settings.rtt();

        for source_node in 0..subnet_size {
            let mut tc_command =
                String::from("sudo tc qdisc del dev enp1s0 root 2> /dev/null || true \n");
            tc_command.push_str("sudo tc qdisc add dev enp1s0 root handle 1: htb \n");
            tc_command.push_str(
                "sudo tc class add dev enp1s0 parent 1: classid 1:1 htb rate 2000Mbps \n",
            );

            for destination_node in 0..subnet_size {
                if source_node == destination_node {
                    continue;
                }
                let destination_ip = nodes[destination_node].get_ip_addr();
                // tc class id start at 1 and we already defined one above so we need to start from 2..
                let tc_class_id = destination_node + 2;
                tc_command.push_str(&format!(
                    "sudo tc class add dev enp1s0 parent 1:1 classid 1:{} htb rate 2000Mbps \n",
                    tc_class_id,
                ));
                tc_command.push_str(&format!(
                        "sudo tc qdisc add dev enp1s0 handle {}: parent 1:{} netem limit 10000000 loss {:.3}% delay {}ms \n",
                        tc_class_id,
                        tc_class_id,
                        packet_loss[(subnet_size-1) * source_node + destination_node].2 * 100.0,
                        (rtt[(subnet_size-1) * source_node + destination_node].2 * 1000.0 / 2.0) as u64
                    ));
                tc_command.push_str(&format!("sudo tc filter add dev enp1s0 protocol ipv6 parent 1: pref {} u32 match ip6 dst {destination_ip} flowid 1:{} \n", tc_class_id, tc_class_id ));
            }
            tc_command.push_str(
                "sudo tc class add dev enp1s0 parent 1:1 classid 1:999 htb rate 2000Mbps \n",
            );
            tc_command.push_str(
                "sudo tc qdisc add dev enp1s0 parent 1:999 handle 999: netem limit 10000000 \n",
            );
            tc_command.push_str("sudo tc filter add dev enp1s0 protocol ipv6 parent 1: pref 999 u32 match ip6 dst ::/0 flowid 1:999 \n");
            tc_commands.push(tc_command);
        }

        nodes.iter().enumerate().for_each(|(idx, node)| {
            let session = node
                .block_on_ssh_session()
                .expect("Failed to ssh into node");
            node.block_on_bash_script_from_session(&session, &tc_commands[idx])
                .expect("Failed to execute bash script from session");
        });
    }
}

impl SimulateNetwork<FixedNetworkSimulation> for SubnetSnapshot {
    fn apply_network_settings(&self, network_settings: FixedNetworkSimulation) {
        let nodes: Vec<_> = self.nodes().collect();

        const DEVICE_NAME: &str = "enp1s0"; // network interface name

        let cfg = get_config();
        let p2p_listen_port = cfg.transport.unwrap().listening_port;

        let bandwidth_mbit_per_sec = network_settings
            .bandwidth_mbit_per_sec
            .unwrap_or(100_000_000);
        let latency_ms = network_settings.latency.map(|d| d.as_millis()).unwrap_or(0);

        let packet_loss = network_settings.packet_loss.unwrap_or(0.0);
        assert!(
            (0.0..=1.0).contains(&packet_loss),
            "Packet loss must be between 0.0 and 1.0"
        );

        let packet_loss_percentage = format!("{:.3}", packet_loss);
        let command = format!(
            r#"set -euo pipefail
sudo tc qdisc del dev {DEVICE_NAME} root 2> /dev/null || true
sudo tc qdisc add dev {DEVICE_NAME} root handle 1: htb default 10
sudo tc class add dev {DEVICE_NAME} parent 1: classid 1:10 htb rate {bandwidth_mbit_per_sec}mbit ceil {bandwidth_mbit_per_sec}mbit
sudo tc qdisc add dev {DEVICE_NAME} parent 1:10 handle 10: netem delay {latency_ms}ms loss {packet_loss_percentage}% limit 10000000
sudo tc filter add dev {DEVICE_NAME} parent 1: protocol ipv6 prio 1 u32 match ip6 dport {p2p_listen_port} 0xFFFF flowid 1:10
sudo tc qdisc show dev {DEVICE_NAME}
"#,
        );

        nodes.iter().for_each(|node| {
            let session = node
                .block_on_ssh_session()
                .expect("Failed to ssh into node");
            node.block_on_bash_script_from_session(&session, &command)
                .expect("Failed to execute bash script from session");
        });
    }
}

#[derive(Default, Clone, Debug)]
pub struct FixedNetworkSimulation {
    packet_loss: Option<f64>,
    latency: Option<Duration>,
    bandwidth_mbit_per_sec: Option<u32>,
}

impl FixedNetworkSimulation {
    pub const fn new() -> Self {
        Self {
            packet_loss: None,
            latency: None,
            bandwidth_mbit_per_sec: None,
        }
    }

    /// Sets the packet loss in each direction in decimal form (0.0 to 1.0).
    pub const fn with_packet_loss(self, packet_loss: f64) -> Self {
        Self {
            packet_loss: Some(packet_loss),
            ..self
        }
    }

    pub const fn with_latency(self, latency: Duration) -> Self {
        Self {
            latency: Some(latency),
            ..self
        }
    }

    pub const fn with_bandwidth(self, bandwidth_mbit_per_sec: u32) -> Self {
        Self {
            bandwidth_mbit_per_sec: Some(bandwidth_mbit_per_sec),
            ..self
        }
    }
}

#[derive(Clone, Debug)]
pub enum ProductionSubnetTopology {
    LHG73,
    /// Canary subnet
    IO67,
    /// Internet Identity Subnet
    UZR34,
}

impl ProductionSubnetTopology {
    fn rtt(&self) -> Vec<(u64, u64, f64)> {
        match self {
            ProductionSubnetTopology::LHG73 => LHG_73_RTT.to_vec(),
            ProductionSubnetTopology::IO67 => IO67_RTT.to_vec(),
            ProductionSubnetTopology::UZR34 => UZR_34_RTT.to_vec(),
        }
    }

    fn packet_loss(&self) -> Vec<(u64, u64, f64)> {
        match self {
            ProductionSubnetTopology::LHG73 => LHG73_PACKET_LOSS.to_vec(),
            ProductionSubnetTopology::IO67 => IO67_PACKET_LOSS.to_vec(),
            ProductionSubnetTopology::UZR34 => UZR_34_PACKET_LOSS.to_vec(),
        }
    }

    fn subnet_size(&self) -> usize {
        match self {
            ProductionSubnetTopology::LHG73 => 13,
            ProductionSubnetTopology::IO67 => 13,
            ProductionSubnetTopology::UZR34 => 28,
        }
    }
}

pub const UZR_34_RTT: [(u64, u64, f64); 750] = [
    (1, 2, 0.18144),
    (1, 3, 0.3331),
    (1, 4, 0.13813),
    (1, 5, 0.26712),
    (1, 6, 0.27461),
    (1, 7, 0.07159),
    (1, 8, 0.21874),
    (1, 9, 0.15367),
    (1, 10, 0.23304),
    (1, 11, 0.27715),
    (1, 12, 0.25495),
    (1, 13, 0.13699),
    (1, 14, 0.17249),
    (1, 15, 0.28334),
    (1, 16, 0.30439),
    (1, 17, 0.23349),
    (1, 18, 0.32438),
    (1, 19, 0.14678),
    (1, 20, 0.05509),
    (1, 21, 0.13716),
    (1, 22, 0.17984),
    (1, 23, 0.26836),
    (1, 24, 0.2453),
    (1, 25, 0.24284),
    (1, 26, 0.19129),
    (1, 27, 0.16593),
    (1, 28, 0.18583),
    (2, 1, 0.18136),
    (2, 3, 0.18225),
    (2, 4, 0.24528),
    (2, 5, 0.15248),
    (2, 6, 0.13985),
    (2, 7, 0.31125),
    (2, 8, 0.0601),
    (2, 9, 0.02348),
    (2, 10, 0.12394),
    (2, 11, 0.04209),
    (2, 12, 0.28869),
    (2, 13, 0.28145),
    (2, 14, 0.03445),
    (2, 15, 0.10637),
    (2, 16, 0.18116),
    (2, 17, 0.06464),
    (2, 18, 0.1745),
    (2, 19, 0.03888),
    (2, 20, 0.25865),
    (2, 21, 0.01792),
    (2, 22, 0.02839),
    (2, 23, 0.15665),
    (2, 24, 0.12445),
    (2, 25, 0.1017),
    (2, 26, 0.03218),
    (2, 27, 0.00938),
    (2, 28, 0.31679),
    (3, 1, 0.33319),
    (3, 2, 0.18226),
    (3, 4, 0.23053),
    (3, 5, 0.15551),
    (3, 6, 0.10642),
    (3, 7, 0.28393),
    (3, 8, 0.22907),
    (3, 9, 0.16525),
    (3, 10, 0.07731),
    (3, 11, 0.23276),
    (3, 12, 0.2642),
    (3, 13, 0.30219),
    (3, 14, 0.18818),
    (3, 15, 0.10362),
    (3, 16, 0.29511),
    (3, 17, 0.22331),
    (3, 18, 0.04182),
    (3, 19, 0.1686),
    (3, 20, 0.32213),
    (3, 21, 0.16403),
    (3, 22, 0.16271),
    (3, 23, 0.13218),
    (3, 24, 0.07434),
    (3, 25, 0.13337),
    (3, 26, 0.1984),
    (3, 27, 0.16772),
    (3, 28, 0.28688),
    (4, 1, 0.13824),
    (4, 2, 0.24521),
    (4, 3, 0.23051),
    (4, 5, 0.14056),
    (4, 6, 0.13613),
    (4, 7, 0.1841),
    (4, 8, 0.30594),
    (4, 9, 0.24106),
    (4, 10, 0.15579),
    (4, 11, 0.25455),
    (4, 12, 0.04938),
    (4, 13, 0.13663),
    (4, 14, 0.23202),
    (4, 15, 0.14639),
    (4, 16, 0.2634),
    (4, 17, 0.31098),
    (4, 18, 0.20689),
    (4, 19, 0.23391),
    (4, 20, 0.13068),
    (4, 21, 0.25538),
    (4, 22, 0.23796),
    (4, 23, 0.10798),
    (4, 24, 0.14715),
    (4, 26, 0.25328),
    (4, 27, 0.26539),
    (4, 28, 0.1324),
    (5, 1, 0.26708),
    (5, 2, 0.15243),
    (5, 3, 0.15546),
    (5, 4, 0.14049),
    (5, 6, 0.03511),
    (5, 7, 0.23659),
    (5, 8, 0.17173),
    (5, 9, 0.1154),
    (5, 10, 0.01534),
    (5, 11, 0.12462),
    (5, 12, 0.18703),
    (5, 13, 0.18463),
    (5, 14, 0.13122),
    (5, 15, 0.02986),
    (5, 16, 0.24058),
    (5, 17, 0.16566),
    (5, 18, 0.09646),
    (5, 19, 0.10725),
    (5, 20, 0.29142),
    (5, 21, 0.1009),
    (5, 22, 0.10452),
    (5, 23, 0.05027),
    (5, 24, 0.0381),
    (5, 26, 0.11756),
    (5, 27, 0.11141),
    (5, 28, 0.22545),
    (6, 1, 0.27464),
    (6, 2, 0.13909),
    (6, 3, 0.10645),
    (6, 4, 0.13607),
    (6, 5, 0.03505),
    (6, 7, 0.21211),
    (6, 8, 0.17823),
    (6, 9, 0.1236),
    (6, 10, 0.01842),
    (6, 11, 0.13728),
    (6, 12, 0.19155),
    (6, 13, 0.16657),
    (6, 14, 0.14336),
    (6, 15, 0.03642),
    (6, 16, 0.25078),
    (6, 17, 0.15961),
    (6, 18, 0.07901),
    (6, 19, 0.1307),
    (6, 20, 0.27628),
    (6, 21, 0.11373),
    (6, 22, 0.11664),
    (6, 23, 0.05385),
    (6, 24, 0.02274),
    (6, 25, 0.03876),
    (6, 26, 0.14459),
    (6, 27, 0.13343),
    (6, 28, 0.20007),
    (7, 1, 0.07155),
    (7, 2, 0.31107),
    (7, 3, 0.28396),
    (7, 4, 0.18414),
    (7, 5, 0.23662),
    (7, 6, 0.21184),
    (7, 8, 0.35574),
    (7, 9, 0.25681),
    (7, 10, 0.23211),
    (7, 11, 0.27946),
    (7, 12, 0.0816),
    (7, 13, 0.06632),
    (7, 14, 0.26596),
    (7, 15, 0.21826),
    (7, 16, 0.42023),
    (7, 17, 0.39813),
    (7, 18, 0.29394),
    (7, 19, 0.24301),
    (7, 20, 0.04911),
    (7, 21, 0.30614),
    (7, 22, 0.26946),
    (7, 23, 0.18061),
    (7, 24, 0.22032),
    (7, 25, 0.27158),
    (7, 26, 0.30755),
    (7, 27, 0.28721),
    (7, 28, 0.25481),
    (8, 1, 0.21875),
    (8, 2, 0.06015),
    (8, 3, 0.2291),
    (8, 4, 0.30596),
    (8, 5, 0.17176),
    (8, 6, 0.17836),
    (8, 7, 0.35565),
    (8, 9, 0.07123),
    (8, 10, 0.16902),
    (8, 11, 0.09733),
    (8, 12, 0.34164),
    (8, 13, 0.32551),
    (8, 14, 0.06813),
    (8, 15, 0.16281),
    (8, 16, 0.22223),
    (8, 17, 0.12412),
    (8, 18, 0.22668),
    (8, 19, 0.09147),
    (8, 20, 0.22845),
    (8, 21, 0.07575),
    (8, 22, 0.09664),
    (8, 23, 0.2003),
    (8, 24, 0.16688),
    (8, 25, 0.15801),
    (8, 26, 0.09545),
    (8, 27, 0.067),
    (8, 28, 0.3661),
    (9, 1, 0.15376),
    (9, 2, 0.02348),
    (9, 3, 0.16518),
    (9, 4, 0.2411),
    (9, 5, 0.11551),
    (9, 6, 0.12363),
    (9, 7, 0.25678),
    (9, 8, 0.07118),
    (9, 10, 0.10754),
    (9, 11, 0.0429),
    (9, 12, 0.29939),
    (9, 13, 0.2714),
    (9, 14, 0.03188),
    (9, 15, 0.09995),
    (9, 16, 0.16377),
    (9, 17, 0.05276),
    (9, 18, 0.16415),
    (9, 19, 0.03241),
    (9, 20, 0.15979),
    (9, 21, 0.00646),
    (9, 22, 0.01498),
    (9, 23, 0.14473),
    (9, 24, 0.11085),
    (9, 25, 0.09055),
    (9, 26, 0.03458),
    (9, 27, 0.01509),
    (9, 28, 0.32307),
    (10, 1, 0.23317),
    (10, 2, 0.12399),
    (10, 3, 0.0773),
    (10, 4, 0.15577),
    (10, 5, 0.01532),
    (10, 6, 0.01834),
    (10, 7, 0.23216),
    (10, 8, 0.16896),
    (10, 9, 0.10757),
    (10, 11, 0.11525),
    (10, 12, 0.20365),
    (10, 13, 0.18055),
    (10, 14, 0.1248),
    (10, 15, 0.03152),
    (10, 16, 0.23477),
    (10, 17, 0.15976),
    (10, 18, 0.07904),
    (10, 19, 0.11408),
    (10, 20, 0.23433),
    (10, 21, 0.10406),
    (10, 22, 0.10314),
    (10, 23, 0.05679),
    (10, 24, 0.02511),
    (10, 25, 0.02117),
    (10, 26, 0.12761),
    (10, 27, 0.11149),
    (10, 28, 0.22085),
    (11, 1, 0.27717),
    (11, 2, 0.04211),
    (11, 3, 0.23277),
    (11, 4, 0.25449),
    (11, 5, 0.12466),
    (11, 6, 0.13727),
    (11, 7, 0.2794),
    (11, 8, 0.0974),
    (11, 9, 0.04285),
    (11, 10, 0.11531),
    (11, 12, 0.30734),
    (11, 13, 0.29067),
    (11, 14, 0.0592),
    (11, 15, 0.11557),
    (11, 16, 0.18403),
    (11, 17, 0.09972),
    (11, 18, 0.18261),
    (11, 19, 0.05219),
    (11, 20, 0.27752),
    (11, 21, 0.03251),
    (11, 22, 0.02692),
    (11, 23, 0.15815),
    (11, 24, 0.13018),
    (11, 25, 0.10773),
    (11, 26, 0.05381),
    (11, 27, 0.04017),
    (11, 28, 0.32841),
    (12, 1, 0.25493),
    (12, 2, 0.2951),
    (12, 3, 0.26425),
    (12, 4, 0.04934),
    (12, 5, 0.18712),
    (12, 6, 0.19153),
    (12, 7, 0.08143),
    (12, 8, 0.3415),
    (12, 9, 0.29944),
    (12, 10, 0.20364),
    (12, 11, 0.30731),
    (12, 13, 0.06067),
    (12, 14, 0.30828),
    (12, 15, 0.19377),
    (12, 16, 0.39722),
    (12, 17, 0.33831),
    (12, 18, 0.25493),
    (12, 19, 0.29057),
    (12, 20, 0.26441),
    (12, 21, 0.27937),
    (12, 22, 0.29411),
    (12, 23, 0.14806),
    (12, 24, 0.19877),
    (12, 25, 0.20764),
    (12, 26, 0.30228),
    (12, 27, 0.29653),
    (12, 28, 0.14168),
    (13, 1, 0.1371),
    (13, 2, 0.28149),
    (13, 3, 0.30226),
    (13, 4, 0.1367),
    (13, 5, 0.18472),
    (13, 6, 0.16606),
    (13, 7, 0.0663),
    (13, 8, 0.32558),
    (13, 9, 0.27145),
    (13, 10, 0.1806),
    (13, 11, 0.29079),
    (13, 12, 0.06069),
    (13, 14, 0.30459),
    (13, 15, 0.19519),
    (13, 16, 0.39916),
    (13, 17, 0.32789),
    (13, 18, 0.235),
    (13, 19, 0.25239),
    (13, 20, 0.25369),
    (13, 21, 0.26737),
    (13, 22, 0.27249),
    (13, 23, 0.30973),
    (13, 24, 0.19548),
    (13, 25, 0.19684),
    (13, 26, 0.30691),
    (13, 27, 0.29796),
    (13, 28, 0.16864),
    (14, 1, 0.17249),
    (14, 2, 0.03443),
    (14, 3, 0.18817),
    (14, 4, 0.23193),
    (14, 5, 0.13124),
    (14, 6, 0.14337),
    (14, 7, 0.26602),
    (14, 8, 0.0681),
    (14, 9, 0.03189),
    (14, 10, 0.12479),
    (14, 11, 0.05927),
    (14, 12, 0.30832),
    (14, 13, 0.30446),
    (14, 15, 0.11798),
    (14, 16, 0.19306),
    (14, 17, 0.08168),
    (14, 18, 0.19533),
    (14, 19, 0.05947),
    (14, 20, 0.19653),
    (14, 21, 0.02995),
    (14, 22, 0.03872),
    (14, 23, 0.16712),
    (14, 24, 0.13191),
    (14, 25, 0.114),
    (14, 26, 0.06163),
    (14, 27, 0.04202),
    (14, 28, 0.33536),
    (15, 1, 0.28334),
    (15, 2, 0.10636),
    (15, 3, 0.10364),
    (15, 4, 0.1464),
    (15, 5, 0.02983),
    (15, 6, 0.0365),
    (15, 7, 0.2185),
    (15, 8, 0.16278),
    (15, 9, 0.09999),
    (15, 10, 0.03147),
    (15, 11, 0.11557),
    (15, 12, 0.19375),
    (15, 13, 0.19519),
    (15, 14, 0.11799),
    (15, 16, 0.23793),
    (15, 17, 0.14095),
    (15, 18, 0.09645),
    (15, 19, 0.11134),
    (15, 20, 0.27601),
    (15, 21, 0.09495),
    (15, 22, 0.09256),
    (15, 23, 0.05782),
    (15, 24, 0.04609),
    (15, 25, 0.01221),
    (15, 26, 0.1157),
    (15, 27, 0.10721),
    (15, 28, 0.23663),
    (16, 1, 0.30429),
    (16, 2, 0.18116),
    (16, 3, 0.2951),
    (16, 4, 0.26337),
    (16, 5, 0.24064),
    (16, 6, 0.25082),
    (16, 7, 0.42027),
    (16, 8, 0.22229),
    (16, 9, 0.16375),
    (16, 10, 0.23486),
    (16, 11, 0.18407),
    (16, 12, 0.39725),
    (16, 13, 0.39918),
    (16, 14, 0.1925),
    (16, 15, 0.23792),
    (16, 17, 0.21217),
    (16, 18, 0.30733),
    (16, 19, 0.139),
    (16, 20, 0.45019),
    (16, 21, 0.17527),
    (16, 22, 0.16676),
    (16, 23, 0.26891),
    (16, 24, 0.23292),
    (16, 25, 0.22063),
    (16, 26, 0.19255),
    (16, 27, 0.17401),
    (16, 28, 0.43085),
    (17, 1, 0.23307),
    (17, 2, 0.06525),
    (17, 3, 0.22326),
    (17, 4, 0.31161),
    (17, 5, 0.16565),
    (17, 6, 0.15965),
    (17, 7, 0.39863),
    (17, 8, 0.12427),
    (17, 9, 0.05282),
    (17, 10, 0.15938),
    (17, 11, 0.09974),
    (17, 12, 0.33798),
    (17, 13, 0.32796),
    (17, 14, 0.08169),
    (17, 15, 0.14108),
    (17, 16, 0.2118),
    (17, 18, 0.21859),
    (17, 19, 0.0718),
    (17, 20, 0.18902),
    (17, 21, 0.0596),
    (17, 22, 0.06235),
    (17, 23, 0.1948),
    (17, 24, 0.1556),
    (17, 25, 0.14057),
    (17, 26, 0.08688),
    (17, 27, 0.07069),
    (17, 28, 0.44449),
    (18, 1, 0.32439),
    (18, 2, 0.17443),
    (18, 3, 0.04185),
    (18, 4, 0.20691),
    (18, 5, 0.09654),
    (18, 6, 0.079),
    (18, 7, 0.29383),
    (18, 8, 0.22671),
    (18, 9, 0.16409),
    (18, 10, 0.07905),
    (18, 11, 0.18256),
    (18, 12, 0.25493),
    (18, 13, 0.23503),
    (18, 14, 0.19529),
    (18, 15, 0.09648),
    (18, 16, 0.30739),
    (18, 17, 0.21854),
    (18, 19, 0.17068),
    (18, 20, 0.30968),
    (18, 21, 0.17018),
    (18, 22, 0.16672),
    (18, 23, 0.12424),
    (18, 24, 0.06198),
    (18, 25, 0.08335),
    (18, 26, 0.19852),
    (18, 27, 0.17254),
    (18, 28, 0.272),
    (19, 1, 0.14669),
    (19, 2, 0.03888),
    (19, 3, 0.16861),
    (19, 4, 0.23387),
    (19, 5, 0.10725),
    (19, 6, 0.13069),
    (19, 7, 0.24292),
    (19, 8, 0.09137),
    (19, 9, 0.03242),
    (19, 10, 0.11412),
    (19, 11, 0.05213),
    (19, 12, 0.2906),
    (19, 13, 0.25238),
    (19, 14, 0.05937),
    (19, 15, 0.11135),
    (19, 16, 0.13898),
    (19, 17, 0.07189),
    (19, 18, 0.17079),
    (19, 20, 0.16616),
    (19, 21, 0.02994),
    (19, 22, 0.03332),
    (19, 23, 0.13189),
    (19, 24, 0.0958),
    (19, 25, 0.10224),
    (19, 26, 0.06113),
    (19, 27, 0.03854),
    (19, 28, 0.31943),
    (20, 1, 0.055),
    (20, 2, 0.25853),
    (20, 3, 0.3219),
    (20, 4, 0.13064),
    (20, 5, 0.2914),
    (20, 6, 0.27619),
    (20, 7, 0.04901),
    (20, 8, 0.22837),
    (20, 9, 0.15998),
    (20, 10, 0.23437),
    (20, 11, 0.27743),
    (20, 12, 0.24511),
    (20, 13, 0.25366),
    (20, 14, 0.19591),
    (20, 15, 0.27605),
    (20, 16, 0.45026),
    (20, 17, 0.18902),
    (20, 18, 0.30952),
    (20, 19, 0.16651),
    (20, 21, 0.25994),
    (20, 22, 0.17408),
    (20, 23, 0.2332),
    (20, 24, 0.2538),
    (20, 25, 0.23227),
    (20, 26, 0.18107),
    (20, 27, 0.15113),
    (20, 28, 0.16535),
    (21, 1, 0.13719),
    (21, 2, 0.01795),
    (21, 3, 0.16405),
    (21, 4, 0.25535),
    (21, 5, 0.10086),
    (21, 6, 0.11371),
    (21, 7, 0.30611),
    (21, 8, 0.07569),
    (21, 9, 0.00649),
    (21, 10, 0.10407),
    (21, 11, 0.03249),
    (21, 12, 0.27932),
    (21, 13, 0.26725),
    (21, 14, 0.02995),
    (21, 15, 0.09493),
    (21, 16, 0.17526),
    (21, 17, 0.05909),
    (21, 18, 0.17021),
    (21, 19, 0.03008),
    (21, 20, 0.26005),
    (21, 22, 0.01012),
    (21, 23, 0.14151),
    (21, 24, 0.10633),
    (21, 25, 0.08552),
    (21, 26, 0.03292),
    (21, 27, 0.01075),
    (21, 28, 0.30152),
    (22, 1, 0.17987),
    (22, 2, 0.02845),
    (22, 3, 0.16262),
    (22, 4, 0.23789),
    (22, 5, 0.10446),
    (22, 6, 0.11669),
    (22, 7, 0.26948),
    (22, 8, 0.0967),
    (22, 9, 0.01507),
    (22, 10, 0.10313),
    (22, 11, 0.02706),
    (22, 12, 0.29413),
    (22, 13, 0.27236),
    (22, 14, 0.03874),
    (22, 15, 0.09244),
    (22, 16, 0.16677),
    (22, 17, 0.06241),
    (22, 18, 0.16665),
    (22, 19, 0.03336),
    (22, 20, 0.17395),
    (22, 21, 0.0101),
    (22, 23, 0.14389),
    (22, 24, 0.10753),
    (22, 25, 0.08467),
    (22, 26, 0.03),
    (22, 27, 0.02215),
    (22, 28, 0.30526),
    (23, 1, 0.26828),
    (23, 2, 0.15652),
    (23, 3, 0.13221),
    (23, 4, 0.108),
    (23, 5, 0.0503),
    (23, 6, 0.05397),
    (23, 7, 0.18064),
    (23, 8, 0.20026),
    (23, 9, 0.14483),
    (23, 10, 0.05682),
    (23, 11, 0.15817),
    (23, 12, 0.14815),
    (23, 13, 0.30981),
    (23, 14, 0.16709),
    (23, 15, 0.05775),
    (23, 16, 0.26895),
    (23, 17, 0.19442),
    (23, 18, 0.12433),
    (23, 19, 0.13197),
    (23, 20, 0.2332),
    (23, 21, 0.1415),
    (23, 22, 0.14397),
    (23, 24, 0.0686),
    (23, 25, 0.06395),
    (23, 26, 0.15421),
    (23, 27, 0.1483),
    (23, 28, 0.16211),
    (24, 1, 0.24537),
    (24, 2, 0.12584),
    (24, 3, 0.07435),
    (24, 4, 0.14708),
    (24, 5, 0.03804),
    (24, 6, 0.02273),
    (24, 7, 0.22037),
    (24, 8, 0.16683),
    (24, 9, 0.11079),
    (24, 10, 0.02514),
    (24, 11, 0.13021),
    (24, 12, 0.1987),
    (24, 13, 0.19546),
    (24, 14, 0.13191),
    (24, 15, 0.04609),
    (24, 16, 0.23297),
    (24, 17, 0.15612),
    (24, 18, 0.06199),
    (24, 19, 0.09575),
    (24, 20, 0.25393),
    (24, 21, 0.10631),
    (24, 22, 0.10756),
    (24, 23, 0.06853),
    (24, 25, 0.0313),
    (24, 26, 0.12393),
    (24, 27, 0.11585),
    (24, 28, 0.2353),
    (25, 1, 0.24285),
    (25, 2, 0.10169),
    (25, 3, 0.13359),
    (25, 6, 0.03879),
    (25, 7, 0.2716),
    (25, 8, 0.15802),
    (25, 9, 0.09051),
    (25, 10, 0.02117),
    (25, 11, 0.10771),
    (25, 12, 0.20757),
    (25, 13, 0.19682),
    (25, 14, 0.11398),
    (25, 15, 0.01223),
    (25, 16, 0.22059),
    (25, 17, 0.14105),
    (25, 18, 0.08338),
    (25, 19, 0.10225),
    (25, 20, 0.23231),
    (25, 21, 0.08552),
    (25, 22, 0.08471),
    (25, 23, 0.06388),
    (25, 24, 0.03126),
    (25, 26, 0.1037),
    (25, 27, 0.10364),
    (26, 1, 0.19139),
    (26, 2, 0.03217),
    (26, 3, 0.19841),
    (26, 4, 0.25312),
    (26, 5, 0.11745),
    (26, 6, 0.14461),
    (26, 7, 0.30777),
    (26, 8, 0.0955),
    (26, 9, 0.0346),
    (26, 10, 0.12756),
    (26, 11, 0.05394),
    (26, 12, 0.30224),
    (26, 13, 0.30696),
    (26, 14, 0.06161),
    (26, 15, 0.11565),
    (26, 16, 0.19262),
    (26, 17, 0.08722),
    (26, 18, 0.19853),
    (26, 19, 0.06104),
    (26, 20, 0.18107),
    (26, 21, 0.03291),
    (26, 22, 0.03001),
    (26, 23, 0.15421),
    (26, 24, 0.1239),
    (26, 25, 0.10373),
    (26, 27, 0.02372),
    (26, 28, 0.32505),
    (27, 1, 0.16591),
    (27, 2, 0.00933),
    (27, 3, 0.1677),
    (27, 4, 0.26535),
    (27, 5, 0.11139),
    (27, 6, 0.13339),
    (27, 7, 0.28718),
    (27, 8, 0.0671),
    (27, 9, 0.01511),
    (27, 10, 0.11143),
    (27, 11, 0.04013),
    (27, 12, 0.29637),
    (27, 13, 0.29787),
    (27, 14, 0.042),
    (27, 15, 0.10723),
    (27, 16, 0.17393),
    (27, 17, 0.07174),
    (27, 18, 0.17248),
    (27, 19, 0.03849),
    (27, 20, 0.1511),
    (27, 21, 0.01072),
    (27, 22, 0.02224),
    (27, 23, 0.14841),
    (27, 24, 0.11587),
    (27, 25, 0.1036),
    (27, 26, 0.02373),
    (27, 28, 0.32928),
    (28, 1, 0.17766),
    (28, 2, 0.31676),
    (28, 3, 0.28671),
    (28, 4, 0.13219),
    (28, 5, 0.22147),
    (28, 6, 0.19979),
    (28, 7, 0.25467),
    (28, 8, 0.36595),
    (28, 9, 0.31066),
    (28, 10, 0.21927),
    (28, 11, 0.32821),
    (28, 12, 0.14196),
    (28, 13, 0.16898),
    (28, 14, 0.33507),
    (28, 15, 0.22575),
    (28, 16, 0.43383),
    (28, 17, 0.43308),
    (28, 18, 0.27218),
    (28, 19, 0.32028),
    (28, 20, 0.16537),
    (28, 21, 0.30134),
    (28, 22, 0.30532),
    (28, 23, 0.15784),
    (28, 24, 0.22502),
    (28, 26, 0.32485),
    (28, 27, 0.31772),
];

/// Query for metrics:
/// https://victoria.ch1-obs1.dfinity.network/select/0/vmui/#/?g0.expr=sum+by+%28ic_node%2Cpeer%29+%28%0A++rate%28quic_transport_quinn_path_lost_packets%7Bic_subnet%3D%22uzr34-akd3s-xrdag-3ql62-ocgoh-ld2ao-tamcv-54e7j-krwgb-2gm4z-oqe%22%7D%5B7d%5D%29+%2F%0A++rate%28quic_transport_quinn_path_sent_packets%7Bic_subnet%3D%22uzr34-akd3s-xrdag-3ql62-ocgoh-ld2ao-tamcv-54e7j-krwgb-2gm4z-oqe%22%7D%5B7d%5D%29%0A%29&g0.range_input=13d14h36m59s549ms&g0.end_input=2024-06-23T20%3A59%3A19&g0.tab=1&g0.relative_time=none&g0.tenantID=0
pub const UZR_34_PACKET_LOSS: [(u64, u64, f64); 750] = [
    (1, 2, 0.001736552486960042),
    (1, 3, 0.0007536414287858031),
    (1, 4, 0.0017763556249538782),
    (1, 5, 0.0010856505105247018),
    (1, 6, 0.0009253231658100954),
    (1, 7, 0.0017914727559403994),
    (1, 8, 0.0010960946107342936),
    (1, 9, 0.001312817786832771),
    (1, 10, 0.0010357656974030252),
    (1, 11, 0.0023472662146069296),
    (1, 12, 0.0016715420129161489),
    (1, 13, 0.021158535738919477),
    (1, 14, 0.0016276692481824496),
    (1, 15, 0.001132933640653826),
    (1, 16, 0.0010353058363221765),
    (1, 17, 0.002677508130172783),
    (1, 18, 0.0008151523363094928),
    (1, 19, 0.004248088456841807),
    (1, 20, 0.0019754615668978875),
    (1, 21, 0.0017946992073240937),
    (1, 22, 0.0015877287917271516),
    (1, 23, 0.0008888463891407511),
    (1, 24, 0.0011818140585151493),
    (1, 25, 0.0009361561521980367),
    (1, 26, 0.0013076292609879219),
    (1, 27, 0.0016184476931051346),
    (1, 28, 0.002228261714327164),
    (2, 1, 0.00008536881376996358),
    (2, 3, 0.000022609985575358535),
    (2, 4, 0.000510951258815295),
    (2, 5, 0.000035063738448066624),
    (2, 6, 0.00002159227169411524),
    (2, 7, 0.00384812762074568),
    (2, 8, 0.0012403822456319837),
    (2, 9, 0.00024488901292950624),
    (2, 10, 0.0039602789093281365),
    (2, 11, 0.00011123916719428832),
    (2, 12, 0.0006506043025785272),
    (2, 13, 0.0012772245718974777),
    (2, 14, 0.002403601739806306),
    (2, 15, 0.0000037023786635175716),
    (2, 16, 0.00000799825456957827),
    (2, 17, 0.00028635710301665033),
    (2, 18, 0.000038173719232863664),
    (2, 19, 0.00017465748984616682),
    (2, 20, 0.00020690448522057563),
    (2, 21, 0.0006794349646478374),
    (2, 22, 0.0005386909660538848),
    (2, 23, 0.000012414976337357905),
    (2, 24, 0.000010786857097188112),
    (2, 25, 0.0001805916979290348),
    (2, 26, 0.00023969113901819422),
    (2, 27, 0.0013141211764398568),
    (2, 28, 0.0022313238801952456),
    (3, 1, 0.0010159876963526098),
    (3, 2, 0.0010202303698187835),
    (3, 4, 0.0009803127472987705),
    (3, 5, 0.000922105234570332),
    (3, 6, 0.0008881385430319251),
    (3, 7, 0.005224590298233594),
    (3, 8, 0.001558256950352699),
    (3, 9, 0.0009795542559730356),
    (3, 10, 0.0005812965861786855),
    (3, 11, 0.001174549006909564),
    (3, 12, 0.0016816630077963373),
    (3, 13, 0.001002957912914247),
    (3, 14, 0.0009149789704502464),
    (3, 15, 0.0004764459396533685),
    (3, 16, 0.0010781680635934187),
    (3, 17, 0.0017383961491918064),
    (3, 18, 0.0011968815294920697),
    (3, 19, 0.0011317470507534312),
    (3, 20, 0.0013243540361491796),
    (3, 21, 0.0006005149622491387),
    (3, 22, 0.0008546011904102586),
    (3, 23, 0.002243042201021228),
    (3, 24, 0.0006493248604187861),
    (3, 25, 0.0007419303351016714),
    (3, 26, 0.0010486389226321163),
    (3, 27, 0.001085883465890381),
    (3, 28, 0.002242695586184961),
    (4, 1, 0.028646201530814937),
    (4, 2, 0.00004079833394851635),
    (4, 3, 0.0000721762408305044),
    (4, 5, 0.000029970268123082065),
    (4, 6, 0.0000057658367880305414),
    (4, 7, 0.0006928727663376526),
    (4, 8, 0.0010072667653511344),
    (4, 9, 0.000002435372445313331),
    (4, 10, 0.000012396253437746712),
    (4, 11, 0.0000014927015505915786),
    (4, 12, 0.000045748413499089356),
    (4, 13, 0.0008879861630822599),
    (4, 14, 0.0029578508013504176),
    (4, 15, 0.0000021581940323208865),
    (4, 16, 0.00003211264850106797),
    (4, 17, 0.010024605400506731),
    (4, 18, 0.0033892147244151973),
    (4, 19, 0.0031580185049113613),
    (4, 20, 0.008692334715805152),
    (4, 21, 0.000029520387289221203),
    (4, 22, 0.000007096481985466632),
    (4, 23, 0.00007456210792447575),
    (4, 24, 0.00009894890277902843),
    (4, 26, 0.00017377659549633166),
    (4, 27, 0.0009871995805374688),
    (4, 28, 0.0016245130738450093),
    (5, 1, 0.05667107403095351),
    (5, 2, 0.0006152108531723416),
    (5, 3, 0.0005845234328393675),
    (5, 4, 0.0008555550129413489),
    (5, 6, 0.0006869947832070748),
    (5, 7, 0.06487826417598729),
    (5, 8, 0.000498649505682042),
    (5, 9, 0.0008353728632119839),
    (5, 10, 0.00045839704684619655),
    (5, 11, 0.000695678981829902),
    (5, 12, 0.0004664219343639949),
    (5, 13, 0.00029818002369043096),
    (5, 14, 0.000564871353172949),
    (5, 15, 0.0006816204216168823),
    (5, 16, 0.0005484008222187189),
    (5, 17, 0.0004894407849636634),
    (5, 18, 0.0010178200091534304),
    (5, 19, 0.0006979715067645715),
    (5, 20, 0.02720776323354111),
    (5, 21, 0.0006747453604287549),
    (5, 22, 0.000635811602405094),
    (5, 23, 0.0007358240830114912),
    (5, 24, 0.0008068603773932698),
    (5, 26, 0.0004955731506591123),
    (5, 27, 0.0007119948899822742),
    (5, 28, 0.0016550093456090629),
    (6, 1, 0.005899299366820127),
    (6, 2, 0.00023169311592776998),
    (6, 3, 0.00003281308501346072),
    (6, 4, 0.00009250502063245117),
    (6, 5, 0.0003387729024176327),
    (6, 7, 0.048671708052270835),
    (6, 8, 0.00038018526453359756),
    (6, 9, 0.00003107044258401667),
    (6, 10, 0.0009372295613362852),
    (6, 11, 0.000023833329457995208),
    (6, 12, 0.00007320356200193054),
    (6, 13, 0.0021215938691884206),
    (6, 14, 0.00009933515981352896),
    (6, 15, 0.00020564563349087655),
    (6, 16, 0.00016402070886179957),
    (6, 17, 0.0002079768243387595),
    (6, 18, 0.0005365689848341277),
    (6, 19, 0.00009259310782311601),
    (6, 20, 0.025716415397311277),
    (6, 21, 0.000022002515583719107),
    (6, 22, 0.000024302540098424523),
    (6, 23, 0.00014366635401996593),
    (6, 24, 0.0005088052229613309),
    (6, 25, 0.00028690704233357185),
    (6, 26, 0.00019309918594165285),
    (6, 27, 0.00004889142224956788),
    (6, 28, 0.001897601067770452),
    (7, 1, 0.009391650109403316),
    (7, 2, 0.00047691419448486305),
    (7, 3, 0.00021525801403233908),
    (7, 4, 0.004347177819904846),
    (7, 5, 0.0009868168966799765),
    (7, 6, 0.0012430973256007637),
    (7, 8, 0.0007745664527964769),
    (7, 9, 0.00020335101487325063),
    (7, 10, 0.008551994088573878),
    (7, 11, 0.001424414200519478),
    (7, 12, 0.000050508930084065806),
    (7, 13, 0.00019098368434987469),
    (7, 14, 0.002438018702646353),
    (7, 15, 0.005031349534108501),
    (7, 16, 0.0003046875043779816),
    (7, 17, 0.0004389562640123133),
    (7, 18, 0.0034758749832940242),
    (7, 19, 0.0003031862970702976),
    (7, 20, 0.0002169121505790155),
    (7, 21, 0.00018558279191789844),
    (7, 22, 0.0021531507385405438),
    (7, 23, 0.00007077616362935941),
    (7, 24, 0.0002105375498313671),
    (7, 25, 0.002524629815538199),
    (7, 26, 0.0007394307596352307),
    (7, 27, 0.00011437267324242114),
    (7, 28, 0.00659258187014243),
    (8, 1, 0.00029283791720870623),
    (8, 2, 0.00078665470326491),
    (8, 3, 0.00030729801005420347),
    (8, 4, 0.0012908998644731787),
    (8, 5, 0.0009446379804002327),
    (8, 6, 0.00022809601814904537),
    (8, 7, 0.004197171702773264),
    (8, 9, 0.0002980730087063995),
    (8, 10, 0.0012925199576531903),
    (8, 11, 0.00033381625963860084),
    (8, 12, 0.0011434354815979628),
    (8, 13, 0.001158188743292627),
    (8, 14, 0.0009225950533820286),
    (8, 15, 0.0007046712391898758),
    (8, 16, 0.00022577406770398428),
    (8, 17, 0.0021084223239546535),
    (8, 18, 0.0001417110457346422),
    (8, 19, 0.00029660869548534706),
    (8, 20, 0.0004153805705250967),
    (8, 21, 0.001038802787403374),
    (8, 22, 0.0003001431908424296),
    (8, 23, 0.0007323116049983243),
    (8, 24, 0.00022858604937054828),
    (8, 25, 0.00028332972731862197),
    (8, 26, 0.000947218037579615),
    (8, 27, 0.00034807737329971505),
    (8, 28, 0.0024162670696299105),
    (9, 1, 0.00010587619212915043),
    (9, 2, 0.0008489908516314672),
    (9, 3, 0.0000811844075225517),
    (9, 4, 0.0005525295322210302),
    (9, 5, 0.00003627772738993489),
    (9, 6, 0.00015505407920316457),
    (9, 7, 0.003005480825282872),
    (9, 8, 0.0013158067224269495),
    (9, 10, 0.00029274926601992736),
    (9, 11, 0.0002322650243397264),
    (9, 12, 0.000039096917924798454),
    (9, 13, 0.0008205534281398023),
    (9, 14, 0.000593672289194367),
    (9, 15, 0.000002616242703308313),
    (9, 16, 0.0000463678321141452),
    (9, 17, 0.00014742978998728723),
    (9, 18, 0.00005265386776507649),
    (9, 19, 0.0009014379167002637),
    (9, 20, 0.00032701046120867707),
    (9, 21, 0.0015960547773343793),
    (9, 22, 0.001341403735596222),
    (9, 23, 0.00010326653489690437),
    (9, 24, 0.00002817028520066242),
    (9, 25, 0.000031285389990929805),
    (9, 26, 0.0002003403969682794),
    (9, 27, 0.0011675861634815102),
    (9, 28, 0.0017685684631945928),
    (10, 1, 0.0001727007375304763),
    (10, 2, 0.00001190819439904314),
    (10, 3, 0.000034181521683012676),
    (10, 4, 0.000020358295696256293),
    (10, 5, 0.001475328491541616),
    (10, 6, 0.0012132443977740314),
    (10, 7, 0.0005536025253177459),
    (10, 8, 0.00026996827901012283),
    (10, 9, 0.000023828290154161626),
    (10, 11, 0.0000034285385060836623),
    (10, 12, 0.00005875382867585513),
    (10, 13, 0.00005135969123062984),
    (10, 14, 0.00003187553164766265),
    (10, 15, 0.0007353580485299659),
    (10, 16, 0.00009338668788671726),
    (10, 17, 0.00006250801342571272),
    (10, 18, 0.00039234336203329307),
    (10, 19, 0.0000021997249830502028),
    (10, 20, 0.0002490765408008235),
    (10, 21, 0.000007149519267065366),
    (10, 22, 0.000013770089055559062),
    (10, 23, 0.00013044678258498864),
    (10, 24, 0.0010199958566534026),
    (10, 25, 0.0009573228571162585),
    (10, 26, 0.0001845028478438966),
    (10, 27, 0.00005733515761402189),
    (10, 28, 0.0018052686884134199),
    (11, 1, 0.000193857010481272),
    (11, 2, 0.00006854304938057459),
    (11, 3, 0.00001842484307067295),
    (11, 4, 0.0008649130466798579),
    (11, 5, 0.000022645114322313065),
    (11, 6, 0.0001482852349046738),
    (11, 7, 0.026351136678571672),
    (11, 8, 0.0002963103691496494),
    (11, 9, 0.00006171415402951856),
    (11, 10, 0.000005916515421060428),
    (11, 12, 0.0066925067939300345),
    (11, 13, 0.00004532402424757977),
    (11, 14, 0.000027145772282895537),
    (11, 15, 0.000001122543803997865),
    (11, 16, 0.000004919403017859263),
    (11, 17, 0.00005045084062642743),
    (11, 18, 0.000272819705729005),
    (11, 19, 0.00002367872618850381),
    (11, 20, 0.00012169412249768146),
    (11, 21, 0.0001606070765523276),
    (11, 22, 0.00019455310538206238),
    (11, 23, 0.000016188443822375835),
    (11, 24, 0.000004997755742639054),
    (11, 25, 0.000009707452478473164),
    (11, 26, 0.0001753516463649756),
    (11, 27, 0.00009173787532521908),
    (11, 28, 0.0017993186128540764),
    (12, 1, 0.00043959282239651687),
    (12, 2, 0.0004468151485530537),
    (12, 3, 0.00006859783024300743),
    (12, 4, 0.000017691565050384826),
    (12, 5, 0.00004775642028016536),
    (12, 6, 0.000021732771742988086),
    (12, 7, 0.0009099200944309254),
    (12, 8, 0.0006304215679463263),
    (12, 9, 0.0000011878358557985662),
    (12, 10, 0.000023444791805356597),
    (12, 11, 0.0000016283370036446554),
    (12, 13, 0.000008508486139322896),
    (12, 14, 0.00005890856936891104),
    (12, 15, 0.000020149117049843257),
    (12, 16, 0.00019522941712933094),
    (12, 17, 0.00009731581039771157),
    (12, 18, 0.000655555197134432),
    (12, 19, 0.0000321583589581857),
    (12, 20, 0.01525247756683505),
    (12, 21, 0.00003370029781850807),
    (12, 22, 0.0000049915609729426825),
    (12, 23, 0.000007804266581229427),
    (12, 24, 0.000003305253285018217),
    (12, 25, 0.000015533230022417887),
    (12, 26, 0.0001955707022529486),
    (12, 27, 0.00006315077945861982),
    (12, 28, 0.0017987873076775304),
    (13, 1, 0.002185793401232277),
    (13, 2, 0.0008507320318192975),
    (13, 3, 0.0008417639741250314),
    (13, 4, 0.0009660095331320324),
    (13, 5, 0.0012789813795784633),
    (13, 6, 0.0011060500286185532),
    (13, 7, 0.0003694883977049208),
    (13, 8, 0.0011548512099835034),
    (13, 9, 0.0008477738917222886),
    (13, 10, 0.0013204385445640214),
    (13, 11, 0.0008207800506087219),
    (13, 12, 0.0004453019607100203),
    (13, 14, 0.000810743184016312),
    (13, 15, 0.0013316476187923089),
    (13, 16, 0.0006478401924222883),
    (13, 17, 0.0006884138597284884),
    (13, 18, 0.0012313834325489825),
    (13, 19, 0.0009325515464248129),
    (13, 20, 0.027018037860555046),
    (13, 21, 0.0008745392459444682),
    (13, 22, 0.0009152173474244439),
    (13, 23, 0.0010611128630719218),
    (13, 24, 0.0013862043580720558),
    (13, 25, 0.0013873904487285485),
    (13, 26, 0.000848721014606955),
    (13, 27, 0.0008762340153478228),
    (13, 28, 0.0024736503220592343),
    (14, 1, 0.00010825135130487572),
    (14, 2, 0.00022070247105669563),
    (14, 3, 0.00004927130068961163),
    (14, 4, 0.0040809624465621),
    (14, 5, 0.0000214830614323322),
    (14, 6, 0.00000722116322612533),
    (14, 7, 0.00468863534939845),
    (14, 8, 0.0008009730512527377),
    (14, 9, 0.00017012166587145776),
    (14, 10, 0.0000398424378450438),
    (14, 11, 0.00003320664661303212),
    (14, 12, 0.00006089106784758294),
    (14, 13, 0.0008560171395189031),
    (14, 15, 0.0000030785154722621068),
    (14, 16, 0.000021497902982479555),
    (14, 17, 0.000006063675544257401),
    (14, 18, 0.0002429105941088581),
    (14, 19, 0.0000527715704333733),
    (14, 20, 0.0001305137505477289),
    (14, 21, 0.00019514639880671388),
    (14, 22, 0.00008327641760227793),
    (14, 23, 0.000030860892567030356),
    (14, 24, 0.00002411493191670582),
    (14, 25, 0.0000029657030334186678),
    (14, 26, 0.0001845580717723157),
    (14, 27, 0.00011450892537349298),
    (14, 28, 0.0017454538686423478),
    (15, 1, 0.00006609154215082273),
    (15, 2, 0.00013587116003407963),
    (15, 3, 0.00007929891602200305),
    (15, 4, 0.0015407349607215713),
    (15, 5, 0.0012030810326925092),
    (15, 6, 0.000387047181286059),
    (15, 7, 0.0062591131694473365),
    (15, 8, 0.0011395922005408112),
    (15, 9, 0.000047530441356852474),
    (15, 10, 0.0005508159077182274),
    (15, 11, 0.0000010044019216217564),
    (15, 12, 0.00002417373115449943),
    (15, 13, 0.00001944842340676388),
    (15, 14, 0.00007777029460539749),
    (15, 16, 0.000243855333459355),
    (15, 17, 0.0006825656412990369),
    (15, 18, 0.00035384207895875874),
    (15, 19, 0.0000901327428588049),
    (15, 20, 0.02488737524592477),
    (15, 21, 0.00005180412193176426),
    (15, 22, 0.00020075144884048468),
    (15, 23, 0.0001123502648176989),
    (15, 24, 0.00017769446630952018),
    (15, 25, 0.0014425946922127309),
    (15, 26, 0.00012290581141301377),
    (15, 27, 0.00009304150163027813),
    (15, 28, 0.0017565678392664785),
    (16, 1, 0.00009064781356166639),
    (16, 2, 0.000359877935995896),
    (16, 3, 0.00008512659031774371),
    (16, 4, 0.0005451715345867308),
    (16, 5, 0.000028049859704465442),
    (16, 6, 0.00019445486283674928),
    (16, 7, 0.003657616933035202),
    (16, 8, 0.000541400506409596),
    (16, 9, 0.0001067349041279914),
    (16, 10, 0.00001209920529081938),
    (16, 11, 0.00003604835352009308),
    (16, 12, 0.0010123378627322022),
    (16, 13, 0.0008189783872528133),
    (16, 14, 0.00008318100660393824),
    (16, 15, 0.0000010281051975515562),
    (16, 17, 0.003271623481497603),
    (16, 18, 0.00006445187763857067),
    (16, 19, 0.000001420216290929632),
    (16, 20, 0.00018289493141340695),
    (16, 21, 0.000004565756944668505),
    (16, 22, 0.00000780620267918015),
    (16, 23, 0.00008316592079383286),
    (16, 24, 0.00001522816288088588),
    (16, 25, 0.00002867758828243619),
    (16, 26, 0.00029693786585627263),
    (16, 27, 0.000015935865142666764),
    (16, 28, 0.002089671713705101),
    (17, 1, 0.00009312038757693588),
    (17, 2, 0.000002649901232292403),
    (17, 3, 0.00005969432837426106),
    (17, 4, 0.0009126419778741123),
    (17, 5, 0.000030281559101198292),
    (17, 6, 0.00016889773045574945),
    (17, 7, 0.07220432595511057),
    (17, 8, 0.0002580134559461874),
    (17, 9, 0.0000044416658547884),
    (17, 10, 0.00003380599174358923),
    (17, 11, 0.0000025016681832874453),
    (17, 12, 0.005714226483974722),
    (17, 13, 0.00003079321803017013),
    (17, 14, 0.00000505780386833392),
    (17, 15, 0.0000025859871138740944),
    (17, 16, 0.000005218015397672819),
    (17, 18, 0.00023420908985225723),
    (17, 19, 0.0000008817810283753607),
    (17, 20, 0.00040592327120984173),
    (17, 21, 0.000000401074646700636),
    (17, 22, 0.0000075268480110888735),
    (17, 23, 0.0000136719067426532),
    (17, 24, 0.00007719817419078329),
    (17, 25, 0.00009286498060058551),
    (17, 26, 0.00019774694099182065),
    (17, 27, 0.00001757242435569319),
    (17, 28, 0.001610514919438926),
    (18, 1, 0.0005706285842077227),
    (18, 2, 0.0008352531577113691),
    (18, 3, 0.003115753842835549),
    (18, 4, 0.0009138836096443196),
    (18, 5, 0.001379010472428019),
    (18, 6, 0.001912162803495722),
    (18, 7, 0.0034124489458430586),
    (18, 8, 0.0006123954160699713),
    (18, 9, 0.0008749153286362586),
    (18, 10, 0.0014756009271615165),
    (18, 11, 0.0008538906634251747),
    (18, 12, 0.0008789351601080649),
    (18, 13, 0.00028534487804668255),
    (18, 14, 0.0022840409057448565),
    (18, 15, 0.00099015767768775),
    (18, 16, 0.0005879014737662725),
    (18, 17, 0.0008678225529461785),
    (18, 19, 0.0009699785463480762),
    (18, 20, 0.007082481789411395),
    (18, 21, 0.0008550794441271805),
    (18, 22, 0.0008276877685321978),
    (18, 23, 0.0010198934828176956),
    (18, 24, 0.0020253879433963506),
    (18, 25, 0.001488243489453231),
    (18, 26, 0.0004489350722192403),
    (18, 27, 0.0008839184604101029),
    (18, 28, 0.001776836210401804),
    (19, 1, 0.005021821958165648),
    (19, 2, 0.006947051463924724),
    (19, 3, 0.0018504185147967067),
    (19, 4, 0.001175794033448153),
    (19, 5, 0.004486160071279554),
    (19, 6, 0.0028859964151575867),
    (19, 7, 0.005987027725958726),
    (19, 8, 0.003989188745406189),
    (19, 9, 0.009873236572656804),
    (19, 10, 0.002108980115606438),
    (19, 11, 0.008827639786596375),
    (19, 12, 0.00032156592498127474),
    (19, 13, 0.0018700817788596708),
    (19, 14, 0.005734606980531864),
    (19, 15, 0.0032158946237615493),
    (19, 16, 0.00759734666885321),
    (19, 17, 0.011525588553962351),
    (19, 18, 0.0017089308121208061),
    (19, 20, 0.004405541242450601),
    (19, 21, 0.009041770392626897),
    (19, 22, 0.00982633469080975),
    (19, 23, 0.0034460924198478223),
    (19, 24, 0.004658799895739681),
    (19, 25, 0.002457917978617859),
    (19, 26, 0.0038746750329178223),
    (19, 27, 0.008529311947011111),
    (19, 28, 0.001799251150177247),
    (20, 1, 0.0009636056161476702),
    (20, 2, 0.001386126369181212),
    (20, 3, 0.0011231328121706983),
    (20, 4, 0.0009626676764075092),
    (20, 5, 0.0007242624457046607),
    (20, 6, 0.0006816325775785611),
    (20, 7, 0.0008247690539257204),
    (20, 8, 0.007314849181324841),
    (20, 9, 0.0007572201410810345),
    (20, 10, 0.0006669258761140001),
    (20, 11, 0.0019832905559816864),
    (20, 12, 0.0009621042347868149),
    (20, 13, 0.0007063526803488126),
    (20, 14, 0.000734177313384843),
    (20, 15, 0.0006627864861848514),
    (20, 16, 0.002509601706841362),
    (20, 17, 0.0008144241015597686),
    (20, 18, 0.0008153404013562045),
    (20, 19, 0.0006849887796552398),
    (20, 21, 0.0007831344136639539),
    (20, 22, 0.0006950306916898177),
    (20, 23, 0.000970853234060555),
    (20, 24, 0.0010863338701085667),
    (20, 25, 0.000703625763126735),
    (20, 26, 0.0010315592833954061),
    (20, 27, 0.0007912257297817947),
    (20, 28, 0.0023911841433213073),
    (21, 1, 0.00008594294498087294),
    (21, 2, 0.001530097187184919),
    (21, 3, 0.00007497824573535722),
    (21, 4, 0.0009010164614482073),
    (21, 5, 0.00002636935503603057),
    (21, 6, 0.0000027059162995000304),
    (21, 7, 0.005260688936698415),
    (21, 8, 0.001519387716607934),
    (21, 9, 0.0015615131673714041),
    (21, 10, 0.0005217739769899188),
    (21, 11, 0.0008098530703193128),
    (21, 12, 0.0061185974760296),
    (21, 13, 0.0012354382540859148),
    (21, 14, 0.0008429342941934238),
    (21, 15, 0.0000037679620835772394),
    (21, 16, 0.00003938812621930658),
    (21, 17, 0.003046454845241262),
    (21, 18, 0.0002502441563781344),
    (21, 19, 0.0007778753790541005),
    (21, 20, 0.00048438337233864366),
    (21, 22, 0.0036279765292887493),
    (21, 23, 0.000013349316218565297),
    (21, 24, 0.000004703490489689214),
    (21, 25, 0.0002099589968848807),
    (21, 26, 0.0003179797733892748),
    (21, 27, 0.0020902530728831707),
    (21, 28, 0.0017314597354452933),
    (22, 1, 0.030352904858338636),
    (22, 2, 0.0034584544450800307),
    (22, 3, 0.004363194012777656),
    (22, 4, 0.0036679498519971735),
    (22, 5, 0.004277525607726681),
    (22, 6, 0.004338112103672853),
    (22, 7, 0.004180436577449973),
    (22, 8, 0.0041902825824817755),
    (22, 9, 0.004802077480959487),
    (22, 10, 0.004366873794209694),
    (22, 11, 0.004510511259545181),
    (22, 12, 0.003676606487016201),
    (22, 13, 0.004241972316443593),
    (22, 14, 0.0041503319664279266),
    (22, 15, 0.004119751148887931),
    (22, 16, 0.004093504651302321),
    (22, 17, 0.005553570782194575),
    (22, 18, 0.004508501437840396),
    (22, 19, 0.0038610082385631362),
    (22, 20, 0.0038806206755967352),
    (22, 21, 0.005260867765338212),
    (22, 23, 0.004176566622506771),
    (22, 24, 0.003958246376771172),
    (22, 25, 0.004134674717818666),
    (22, 26, 0.004631497928767617),
    (22, 27, 0.004229158836673046),
    (22, 28, 0.005240052650950973),
    (23, 1, 0.00008924540224683086),
    (23, 2, 0.0003908695579248945),
    (23, 3, 0.000028800428022171395),
    (23, 4, 0.00039271753010790966),
    (23, 5, 0.000050515840399411906),
    (23, 6, 0.00002405400200569981),
    (23, 7, 0.003081296644243185),
    (23, 8, 0.0005303384163230746),
    (23, 9, 0.0001665054703421788),
    (23, 10, 0.000009191793875272431),
    (23, 11, 0.0000006852370213919198),
    (23, 12, 0.00003922194860243792),
    (23, 13, 0.0011346421462261828),
    (23, 14, 0.000013986157895719663),
    (23, 15, 0.000002919642962405753),
    (23, 16, 0.00016650423909134613),
    (23, 17, 0.0035995511313466092),
    (23, 18, 0.000041054965030440274),
    (23, 19, 0.00015792097060778165),
    (23, 20, 0.02734150580609112),
    (23, 21, 0.000004245624864623324),
    (23, 22, 0.000017412715342632435),
    (23, 24, 0.000006977684585274079),
    (23, 25, 0.000009641476542821164),
    (23, 26, 0.0002148970578718345),
    (23, 27, 0.000023813818935173673),
    (23, 28, 0.0017068120554631352),
    (24, 1, 0.00012951953928287506),
    (24, 2, 0.0003669162268918643),
    (24, 3, 0.000023988823059224133),
    (24, 4, 0.0038168865620641403),
    (24, 5, 0.0003470821570623591),
    (24, 6, 0.0008742773220179948),
    (24, 7, 0.004579448373149811),
    (24, 8, 0.0006097134841460029),
    (24, 9, 0.0001732573414566029),
    (24, 10, 0.0006743098837657984),
    (24, 11, 0.0000013247840601981877),
    (24, 12, 0.005048602078507475),
    (24, 13, 0.0000485685701081729),
    (24, 14, 0.00002850100549203792),
    (24, 15, 0.00014836309133218144),
    (24, 16, 0.000051753037827768604),
    (24, 17, 0.0021951795861980617),
    (24, 18, 0.00013855849789562314),
    (24, 19, 0.000024005048164747687),
    (24, 20, 0.0002527041917421979),
    (24, 21, 0.0000036522731822822713),
    (24, 22, 0.000008222747915849663),
    (24, 23, 0.0019871718515676305),
    (24, 25, 0.0003548197983224438),
    (24, 26, 0.0003281335548804959),
    (24, 27, 0.000022721215189604486),
    (24, 28, 0.003799693958212014),
    (25, 1, 0.02966518505535696),
    (25, 2, 0.000024441176677992923),
    (25, 3, 0.00001100348700881436),
    (25, 6, 0.00019276548692923615),
    (25, 7, 0.005700241472973076),
    (25, 8, 0.00022517837782132203),
    (25, 9, 0.00000562156227135821),
    (25, 10, 0.0007407775711918362),
    (25, 11, 0.0000007829629645095565),
    (25, 12, 0.000028868431087564366),
    (25, 13, 0.00004444958243381179),
    (25, 14, 0.00003467872038068397),
    (25, 15, 0.001383626844116855),
    (25, 16, 0.00019201969764588234),
    (25, 17, 0.000028057934782060564),
    (25, 18, 0.00040225298221880995),
    (25, 19, 0.0010025568564123266),
    (25, 20, 0.00013881461627067963),
    (25, 21, 0.000006221876382434664),
    (25, 22, 0.000010092051945985292),
    (25, 23, 0.00006402981379991429),
    (25, 24, 0.0002495146454451014),
    (25, 26, 0.00016245396359661871),
    (25, 27, 0.000022631409664732513),
    (26, 1, 0.0008213141175040405),
    (26, 2, 0.004000142409030334),
    (26, 3, 0.0003260504721861871),
    (26, 4, 0.0010821432624229736),
    (26, 5, 0.000957354739924425),
    (26, 6, 0.0004970647059076284),
    (26, 7, 0.08519953705450897),
    (26, 8, 0.001027268451490244),
    (26, 9, 0.003252151864757663),
    (26, 10, 0.0005907988701287267),
    (26, 11, 0.0019944342834120883),
    (26, 12, 0.0003639469634390159),
    (26, 13, 0.00027972901884339125),
    (26, 14, 0.0033276005319349605),
    (26, 15, 0.000696157940534746),
    (26, 16, 0.00036871602505235933),
    (26, 17, 0.002500598338295474),
    (26, 18, 0.0025229441604633536),
    (26, 19, 0.0019421921131214301),
    (26, 20, 0.0005770965869842257),
    (26, 21, 0.00321026196793228),
    (26, 22, 0.004468957459394432),
    (26, 23, 0.00043424458224448973),
    (26, 24, 0.0005632509840509888),
    (26, 25, 0.0010764340919791507),
    (26, 27, 0.004181099009801372),
    (26, 28, 0.0019099579506213441),
    (27, 1, 0.028290060617841145),
    (27, 2, 0.03028240454999884),
    (27, 3, 0.0011315164295135768),
    (27, 4, 0.001254431398671734),
    (27, 5, 0.004901585083168362),
    (27, 6, 0.002853093557370532),
    (27, 7, 0.052454204832085495),
    (27, 8, 0.012694127733342385),
    (27, 9, 0.02233627611479071),
    (27, 10, 0.005218082533459472),
    (27, 11, 0.01740917381998511),
    (27, 12, 0.0007276454782192509),
    (27, 13, 0.0005189043430755994),
    (27, 14, 0.01187866519810675),
    (27, 15, 0.005717841637081081),
    (27, 16, 0.0037584148052998406),
    (27, 17, 0.009928233034416875),
    (27, 18, 0.002000084602923329),
    (27, 19, 0.018871817593567812),
    (27, 20, 0.005283522561357353),
    (27, 21, 0.024844714027410012),
    (27, 22, 0.01577847200778667),
    (27, 23, 0.0025565259392875254),
    (27, 24, 0.0031559329723388177),
    (27, 25, 0.003219446639148766),
    (27, 26, 0.02393928403187341),
    (27, 28, 0.0018223477552345249),
    (28, 1, 0.002176449605890672),
    (28, 2, 0.0021286237179275968),
    (28, 3, 0.0019488971352014286),
    (28, 4, 0.0021695806417030496),
    (28, 5, 0.0019793276273191067),
    (28, 6, 0.002098012706564828),
    (28, 7, 0.0019683865454818102),
    (28, 8, 0.002302788738269567),
    (28, 9, 0.0018231399693138897),
    (28, 10, 0.002012662652371089),
    (28, 11, 0.0018629907477559588),
    (28, 12, 0.0029545255016251363),
    (28, 13, 0.0021395959710121767),
    (28, 14, 0.001857430997065144),
    (28, 15, 0.0019991917027082713),
    (28, 16, 0.0018793581605531144),
    (28, 17, 0.003834103158412906),
    (28, 18, 0.00212004432946907),
    (28, 19, 0.0019673665796720134),
    (28, 20, 0.002156807619904932),
    (28, 21, 0.0023161616359913847),
    (28, 22, 0.0018521955088067498),
    (28, 23, 0.002220737744548795),
    (28, 24, 0.001976183797842772),
    (28, 26, 0.0020347347200134606),
    (28, 27, 0.0018901014707244223),
];

const LHG_73_RTT: [(u64, u64, f64); 156] = [
    (1, 2, 0.61712),
    (1, 3, 0.16138),
    (1, 4, 0.1979),
    (1, 5, 0.31523),
    (1, 6, 0.03331),
    (1, 7, 0.0301),
    (1, 8, 0.0968),
    (1, 9, 0.1448),
    (1, 10, 0.26926),
    (1, 11, 0.04916),
    (1, 12, 0.03823),
    (1, 13, 0.31636),
    (2, 1, 0.4457),
    (2, 3, 0.21571),
    (2, 4, 0.31776),
    (2, 5, 0.31094),
    (2, 6, 0.34994),
    (2, 7, 0.24353),
    (2, 8, 0.36381),
    (2, 9, 0.05638),
    (2, 10, 0.21407),
    (2, 11, 0.33622),
    (2, 12, 0.27787),
    (2, 13, 0.03922),
    (3, 1, 0.16143),
    (3, 2, 0.21653),
    (3, 4, 0.13629),
    (3, 5, 0.1642),
    (3, 6, 0.17138),
    (3, 7, 0.13677),
    (3, 8, 0.20414),
    (3, 9, 0.24348),
    (3, 10, 0.14349),
    (3, 11, 0.15612),
    (3, 12, 0.16038),
    (3, 13, 0.16789),
    (4, 1, 0.19735),
    (4, 2, 0.32791),
    (4, 3, 0.13626),
    (4, 5, 0.24396),
    (4, 6, 0.18301),
    (4, 7, 0.16498),
    (4, 8, 0.23006),
    (4, 9, 0.28532),
    (4, 10, 0.32546),
    (4, 11, 0.17209),
    (4, 12, 0.1687),
    (4, 13, 0.3046),
    (5, 1, 0.32781),
    (5, 2, 0.31353),
    (5, 3, 0.16413),
    (5, 4, 0.24397),
    (5, 6, 0.30252),
    (5, 7, 0.28085),
    (5, 8, 0.35983),
    (5, 9, 0.25506),
    (5, 10, 0.03217),
    (5, 11, 0.2806),
    (5, 12, 0.28543),
    (5, 13, 0.39781),
    (6, 1, 0.03333),
    (6, 2, 0.35234),
    (6, 3, 0.17143),
    (6, 4, 0.18291),
    (6, 5, 0.3025),
    (6, 7, 0.02777),
    (6, 8, 0.07972),
    (6, 9, 0.1297),
    (6, 10, 0.25978),
    (6, 11, 0.02073),
    (6, 12, 0.02456),
    (6, 13, 0.33166),
    (7, 1, 0.03004),
    (7, 2, 0.24537),
    (7, 3, 0.13675),
    (7, 4, 0.16501),
    (7, 5, 0.27803),
    (7, 6, 0.02777),
    (7, 8, 0.07466),
    (7, 9, 0.13592),
    (7, 10, 0.23801),
    (7, 11, 0.01887),
    (7, 12, 0.01972),
    (7, 13, 0.29473),
    (8, 1, 0.09677),
    (8, 2, 0.34166),
    (8, 3, 0.20411),
    (8, 4, 0.23096),
    (8, 5, 0.35981),
    (8, 6, 0.0798),
    (8, 7, 0.07474),
    (8, 9, 0.17424),
    (8, 10, 0.30549),
    (8, 11, 0.08596),
    (8, 12, 0.08187),
    (8, 13, 0.27698),
    (9, 1, 0.14482),
    (9, 2, 0.05636),
    (9, 3, 0.24343),
    (9, 4, 0.28514),
    (9, 5, 0.25525),
    (9, 6, 0.12969),
    (9, 7, 0.13586),
    (9, 8, 0.17429),
    (9, 10, 0.25616),
    (9, 11, 0.10919),
    (9, 12, 0.14037),
    (9, 13, 0.23707),
    (10, 1, 0.26862),
    (10, 2, 0.19502),
    (10, 3, 0.16683),
    (10, 4, 0.29872),
    (10, 5, 0.03211),
    (10, 6, 0.25981),
    (10, 7, 0.23806),
    (10, 8, 0.30551),
    (10, 9, 0.25588),
    (10, 11, 0.2647),
    (10, 12, 0.27553),
    (10, 13, 0.05266),
    (11, 1, 0.04922),
    (11, 2, 0.32807),
    (11, 3, 0.15616),
    (11, 4, 0.17251),
    (11, 5, 0.28066),
    (11, 6, 0.02084),
    (11, 7, 0.01885),
    (11, 8, 0.08604),
    (11, 9, 0.10918),
    (11, 10, 0.26476),
    (11, 12, 0.02555),
    (11, 13, 0.2858),
    (12, 1, 0.03829),
    (12, 2, 0.27083),
    (12, 3, 0.16036),
    (12, 4, 0.16875),
    (12, 5, 0.2854),
    (12, 6, 0.02457),
    (12, 7, 0.01961),
    (12, 8, 0.08141),
    (12, 9, 0.1404),
    (12, 10, 0.27557),
    (12, 11, 0.02553),
    (12, 13, 0.30877),
    (13, 1, 0.31634),
    (13, 2, 0.03919),
    (13, 3, 0.16781),
    (13, 4, 0.31543),
    (13, 5, 0.40834),
    (13, 6, 0.32947),
    (13, 7, 0.2947),
    (13, 8, 0.27695),
    (13, 9, 0.23713),
    (13, 10, 0.05268),
    (13, 11, 0.29273),
    (13, 12, 0.30878),
];

const LHG73_PACKET_LOSS: [(u64, u64, f64); 156] = [
    (1, 2, 0.10996749729144095),
    (1, 3, 0.0),
    (1, 4, 0.00014506208657305328),
    (1, 5, 0.00017493731412910373),
    (1, 6, 0.0),
    (1, 7, 0.00021835849005104132),
    (1, 8, 0.000028244598220590316),
    (1, 9, 0.0),
    (1, 10, 0.00017437298381237467),
    (1, 11, 0.0004203211253397596),
    (1, 12, 0.00025079418157498745),
    (1, 13, 0.00017522852720422885),
    (2, 1, 0.46462264150943394),
    (2, 3, 0.0),
    (2, 4, 0.004377136649733218),
    (2, 5, 0.0),
    (2, 6, 0.0038299891540130152),
    (2, 7, 0.5499092558983666),
    (2, 8, 0.13039882959099292),
    (2, 9, 0.0),
    (2, 10, 0.00035081564637782847),
    (2, 11, 0.00006247461968575268),
    (2, 12, 0.00002988196623337816),
    (2, 13, 0.0),
    (3, 1, 0.00011286681715575621),
    (3, 2, 0.0398395352054226),
    (3, 4, 0.0),
    (3, 5, 0.0),
    (3, 6, 0.0),
    (3, 7, 0.0),
    (3, 8, 0.0008279800142755175),
    (3, 9, 0.0),
    (3, 10, 0.00046834536338090247),
    (3, 11, 0.0),
    (3, 12, 0.0),
    (3, 13, 0.0),
    (4, 1, 0.0),
    (4, 2, 0.016789015769439915),
    (4, 3, 0.0),
    (4, 5, 0.0),
    (4, 6, 0.0),
    (4, 7, 0.0),
    (4, 8, 0.000058462437883659755),
    (4, 9, 0.0),
    (4, 10, 0.0009978868278938716),
    (4, 11, 0.0),
    (4, 12, 0.0),
    (4, 13, 0.000029207313511303232),
    (5, 1, 0.0008459496514104023),
    (5, 2, 0.0),
    (5, 3, 0.0),
    (5, 4, 0.0),
    (5, 6, 0.0),
    (5, 7, 0.0),
    (5, 8, 0.0),
    (5, 9, 0.0),
    (5, 10, 0.0),
    (5, 11, 0.0),
    (5, 12, 0.000028875028875028877),
    (5, 13, 0.00707166153564788),
    (6, 1, 0.00016115602589240148),
    (6, 2, 0.022668947818648418),
    (6, 3, 0.0),
    (6, 4, 0.0),
    (6, 5, 0.0),
    (6, 7, 0.0),
    (6, 8, 0.00005460601758313766),
    (6, 9, 0.0),
    (6, 10, 0.0),
    (6, 11, 0.0),
    (6, 12, 0.0),
    (6, 13, 0.0),
    (7, 1, 0.0029997857295907438),
    (7, 2, 0.0033869115958668193),
    (7, 3, 0.0032367831355299198),
    (7, 4, 0.0033353887549750546),
    (7, 5, 0.003399915002124947),
    (7, 6, 0.0025975461478943297),
    (7, 8, 0.0030563669804176134),
    (7, 9, 0.0035285815102328866),
    (7, 10, 0.002148109388339622),
    (7, 11, 0.003549532107131333),
    (7, 12, 0.003492063492063492),
    (7, 13, 0.003373956545766557),
    (8, 1, 0.00011341404632963793),
    (8, 2, 0.021753561762753407),
    (8, 3, 0.0),
    (8, 4, 0.0),
    (8, 5, 0.00023399338968674137),
    (8, 6, 0.0),
    (8, 7, 0.0),
    (8, 9, 0.0),
    (8, 10, 0.0009087977485268681),
    (8, 11, 0.00016970725498515062),
    (8, 12, 0.0),
    (8, 13, 0.0),
    (9, 1, 0.000055850321139346556),
    (9, 2, 0.0),
    (9, 3, 0.0),
    (9, 4, 0.0),
    (9, 5, 0.0),
    (9, 6, 0.0),
    (9, 7, 0.000027785495971103084),
    (9, 8, 0.0003091190108191654),
    (9, 10, 0.0),
    (9, 11, 0.0),
    (9, 12, 0.0),
    (9, 13, 0.000029191114224829965),
    (10, 1, 0.0013883264881124544),
    (10, 2, 0.0),
    (10, 3, 0.0),
    (10, 4, 0.0),
    (10, 5, 0.0),
    (10, 6, 0.0),
    (10, 7, 0.0),
    (10, 8, 0.00002900063801403631),
    (10, 9, 0.0),
    (10, 11, 0.0),
    (10, 12, 0.00014441684478077522),
    (10, 13, 0.0),
    (11, 1, 0.0),
    (11, 2, 0.017175265040440823),
    (11, 3, 0.0),
    (11, 4, 0.0),
    (11, 5, 0.0),
    (11, 6, 0.0),
    (11, 7, 0.0),
    (11, 8, 0.000055944055944055945),
    (11, 9, 0.0),
    (11, 10, 0.0024500510427300573),
    (11, 12, 0.0),
    (11, 13, 0.20009510223490254),
    (12, 1, 0.00005495562333415767),
    (12, 2, 0.008612001832340814),
    (12, 3, 0.00005611672278338946),
    (12, 4, 0.0005651313930488839),
    (12, 5, 0.000028395377232586536),
    (12, 6, 0.00018987685129930016),
    (12, 7, 0.0001321912013536379),
    (12, 8, 0.00005529902950203224),
    (12, 9, 0.00027585445918733276),
    (12, 10, 0.0013517400057520852),
    (12, 11, 0.0),
    (12, 13, 0.00005702554744525548),
    (13, 1, 0.00008762705923589204),
    (13, 2, 0.0),
    (13, 3, 0.0),
    (13, 4, 0.0),
    (13, 5, 0.000240132072639952),
    (13, 6, 0.0),
    (13, 7, 0.0),
    (13, 8, 0.000057097179399337676),
    (13, 9, 0.0),
    (13, 10, 0.0),
    (13, 11, 0.0),
    (13, 12, 0.00002901073397156948),
];

const IO67_RTT: [(u64, u64, f64); 156] = [
    (1, 2, 0.16734),
    (1, 3, 0.27353),
    (1, 4, 0.30555),
    (1, 5, 0.23737),
    (1, 6, 0.25876),
    (1, 7, 0.19405),
    (1, 8, 0.25064),
    (1, 9, 0.18161),
    (1, 10, 0.23736),
    (1, 11, 0.05576),
    (1, 12, 0.2812),
    (1, 13, 0.11474),
    (2, 1, 0.16745),
    (2, 3, 0.12441),
    (2, 4, 0.17481),
    (2, 5, 0.10927),
    (2, 6, 0.12067),
    (2, 7, 0.24545),
    (2, 8, 0.26332),
    (2, 9, 0.04151),
    (2, 10, 0.22915),
    (2, 11, 0.22803),
    (2, 12, 0.13506),
    (2, 13, 0.09143),
    (3, 1, 0.27369),
    (3, 2, 0.12448),
    (3, 4, 0.07763),
    (3, 5, 0.02511),
    (3, 6, 0.01955),
    (3, 7, 0.33227),
    (3, 8, 0.19035),
    (3, 9, 0.10048),
    (3, 10, 0.36291),
    (3, 11, 0.32749),
    (3, 12, 0.00252),
    (3, 13, 0.16926),
    (4, 1, 0.30565),
    (4, 2, 0.17482),
    (4, 3, 0.07763),
    (4, 5, 0.07412),
    (4, 6, 0.06778),
    (4, 7, 0.31882),
    (4, 8, 0.24298),
    (4, 9, 0.14879),
    (4, 10, 0.37033),
    (4, 11, 0.37262),
    (4, 12, 0.07774),
    (4, 13, 0.20558),
    (5, 1, 0.23735),
    (5, 2, 0.10931),
    (5, 3, 0.0251),
    (5, 4, 0.07417),
    (5, 6, 0.0152),
    (5, 7, 0.20899),
    (5, 8, 0.1815),
    (5, 9, 0.08172),
    (5, 10, 0.32365),
    (5, 11, 0.32509),
    (5, 12, 0.02524),
    (5, 13, 0.1358),
    (6, 1, 0.25877),
    (6, 2, 0.1207),
    (6, 3, 0.01956),
    (6, 4, 0.06777),
    (6, 5, 0.01518),
    (6, 7, 0.26372),
    (6, 8, 0.1825),
    (6, 9, 0.09002),
    (6, 10, 0.30955),
    (6, 11, 0.31012),
    (6, 12, 0.02154),
    (6, 13, 0.14768),
    (7, 1, 0.19406),
    (7, 2, 0.24547),
    (7, 3, 0.33227),
    (7, 4, 0.31866),
    (7, 5, 0.20844),
    (7, 6, 0.26364),
    (7, 8, 0.28578),
    (7, 9, 0.33597),
    (7, 10, 0.11232),
    (7, 11, 0.03261),
    (7, 12, 0.33047),
    (7, 13, 0.20231),
    (8, 1, 0.25065),
    (8, 2, 0.26337),
    (8, 3, 0.1903),
    (8, 4, 0.24296),
    (8, 5, 0.18148),
    (8, 6, 0.18248),
    (8, 7, 0.28589),
    (8, 9, 0.25825),
    (8, 10, 0.32082),
    (8, 11, 0.42551),
    (8, 12, 0.1919),
    (8, 13, 0.30328),
    (9, 1, 0.18172),
    (9, 2, 0.04157),
    (9, 3, 0.10048),
    (9, 4, 0.14877),
    (9, 5, 0.08173),
    (9, 6, 0.08999),
    (9, 7, 0.33593),
    (9, 8, 0.25829),
    (9, 10, 0.3733),
    (9, 11, 0.21682),
    (9, 12, 0.10349),
    (9, 13, 0.06968),
    (10, 1, 0.23699),
    (10, 2, 0.22907),
    (10, 3, 0.36289),
    (10, 4, 0.37027),
    (10, 5, 0.32357),
    (10, 6, 0.30947),
    (10, 7, 0.11226),
    (10, 8, 0.32078),
    (10, 9, 0.37328),
    (10, 11, 0.12819),
    (10, 12, 0.36405),
    (10, 13, 0.1937),
    (11, 1, 0.05577),
    (11, 2, 0.22817),
    (11, 3, 0.32739),
    (11, 4, 0.37252),
    (11, 5, 0.32532),
    (11, 6, 0.31036),
    (11, 7, 0.03266),
    (11, 8, 0.42551),
    (11, 9, 0.21658),
    (11, 10, 0.12826),
    (11, 12, 0.33359),
    (11, 13, 0.16365),
    (12, 1, 0.28104),
    (12, 2, 0.13512),
    (12, 3, 0.00253),
    (12, 4, 0.07771),
    (12, 5, 0.02525),
    (12, 6, 0.02147),
    (12, 7, 0.33049),
    (12, 8, 0.1919),
    (12, 9, 0.10349),
    (12, 10, 0.36412),
    (12, 11, 0.33376),
    (12, 13, 0.16952),
    (13, 1, 0.11449),
    (13, 2, 0.09144),
    (13, 3, 0.1693),
    (13, 4, 0.20561),
    (13, 5, 0.13581),
    (13, 6, 0.14766),
    (13, 7, 0.20231),
    (13, 8, 0.3031),
    (13, 9, 0.06971),
    (13, 10, 0.1938),
    (13, 11, 0.16366),
    (13, 12, 0.1695),
];

/// Query for the metric:
/// https://victoria.ch1-obs1.dfinity.network/select/0/vmui/#/?g0.expr=sum+by+%28ic_node%2Cpeer%29+%28%0A++rate%28quic_transport_quinn_path_lost_packets%7Bic_ProductionSubnetTopology%3D%22io67a-2jmkw-zup3h-snbwi-g6a5n-rm5dn-b6png-lvdpl-nqnto-yih6l-gqe%22%7D%5B7d%5D%29+%2F%0A++rate%28quic_transport_quinn_path_sent_packets%7Bic_ProductionSubnetTopology%3D%22io67a-2jmkw-zup3h-snbwi-g6a5n-rm5dn-b6png-lvdpl-nqnto-yih6l-gqe%22%7D%5B7d%5D%29%0A%29&g0.range_input=10d2h52m42s818ms&g0.end_input=2024-05-12T13%3A19%3A31&g0.tab=1&g0.relative_time=none&g0.tenantID=0
const IO67_PACKET_LOSS: [(u64, u64, f64); 156] = [
    (1, 2, 0.0000025116739926176536),
    (1, 3, 0.0004579456767444065),
    (1, 4, 0.001850035700864664),
    (1, 5, 0.000995202969108691),
    (1, 6, 0.00001909138613960752),
    (1, 7, 0.00019945655637087513),
    (1, 8, 0.00020795407398626622),
    (1, 9, 0.000026004830460787808),
    (1, 10, 0.00006330761514513749),
    (1, 11, 0.00009654861405968816),
    (1, 12, 0.0004536072375606995),
    (1, 13, 0.0009260210590594368),
    (2, 1, 0.000026576950863990973),
    (2, 3, 0.0004114995052709546),
    (2, 4, 0.0018229081737066288),
    (2, 5, 0.0000005933958768819974),
    (2, 6, 0.00013024455288572292),
    (2, 7, 0.020455982007400803),
    (2, 8, 0.000031435626028901895),
    (2, 9, 0.000023947440365412273),
    (2, 10, 0.00006601200235208804),
    (2, 11, 0.0006411684186170226),
    (2, 12, 0.00041909322428773237),
    (2, 13, 0.00007295633111814528),
    (3, 1, 0.010389597449360232),
    (3, 2, 0.000005401243077713142),
    (3, 4, 0.0021555313839978565),
    (3, 5, 0.000006727880551439605),
    (3, 6, 0.0011608136729818863),
    (3, 7, 0.0005629997811317654),
    (3, 8, 0.00001949232259855781),
    (3, 9, 0.00101600480987657),
    (3, 10, 0.00005065854264858888),
    (3, 11, 0.005021689441758273),
    (3, 12, 0.0000032934530928022075),
    (3, 13, 0.0000023184022386039645),
    (4, 1, 0.0018678684335336694),
    (4, 2, 0.000031416668268300735),
    (4, 3, 0.0005144044320281668),
    (4, 5, 0.0001028766894281342),
    (4, 6, 0.00019102556100341472),
    (4, 7, 0.0004362537524155629),
    (4, 8, 0.000056674819121417206),
    (4, 9, 0.00015202853894404224),
    (4, 10, 0.0003617712393357278),
    (4, 11, 0.003004178416230635),
    (4, 12, 0.0005811423720677048),
    (4, 13, 0.000051074816581858724),
    (5, 1, 0.0010432149107949453),
    (5, 2, 0.0009475517681796154),
    (5, 3, 0.0022883193286215905),
    (5, 4, 0.002610988212034662),
    (5, 6, 0.001153250918564546),
    (5, 7, 0.0021525973193944293),
    (5, 8, 0.0010767507701540298),
    (5, 9, 0.00043418753932369356),
    (5, 10, 0.001272768969006755),
    (5, 11, 0.010749916709952487),
    (5, 12, 0.0019574384042711),
    (5, 13, 0.0009673222429462834),
    (6, 1, 0.0067117374811837705),
    (6, 2, 0.00006556061456508818),
    (6, 3, 0.0007314081054916355),
    (6, 4, 0.0018472198140076258),
    (6, 5, 0.000006429619908156391),
    (6, 7, 0.0012561006357616922),
    (6, 8, 0.00003722154298823348),
    (6, 9, 0.001102775770117787),
    (6, 10, 0.00003790317704034539),
    (6, 11, 0.00433350243550568),
    (6, 12, 0.0004261915770601068),
    (6, 13, 0.00005815573915253811),
    (7, 1, 0.006823172227417568),
    (7, 2, 0.00008792702682246431),
    (7, 3, 0.001476173624351456),
    (7, 4, 0.030076349208947972),
    (7, 5, 0.037095492354744415),
    (7, 6, 0.030038303242105942),
    (7, 8, 0.0002786281336062296),
    (7, 9, 0.000021040752994576822),
    (7, 10, 0.000001095917541365759),
    (7, 11, 0.00004952133633027111),
    (7, 12, 0.0024578454093489278),
    (7, 13, 0.000016841824481378308),
    (8, 1, 0.00005370160093649248),
    (8, 2, 0.000017874223930090313),
    (8, 3, 0.00006836185034737848),
    (8, 4, 0.0013723956396028574),
    (8, 5, 0.000015717180752751758),
    (8, 6, 0.000017518158418853967),
    (8, 7, 0.00008481692748439206),
    (8, 9, 0.0025713202866593163),
    (8, 10, 0.00004845256158888936),
    (8, 11, 0.00597232779894635),
    (8, 12, 0.000019538842338310524),
    (8, 13, 0.000019167036921761375),
    (9, 1, 0.000017309396411480213),
    (9, 2, 0.000027680298114631145),
    (9, 3, 0.0005667623474787441),
    (9, 4, 0.002033220199129239),
    (9, 5, 0.000004030380786458279),
    (9, 6, 0.00008071943646350249),
    (9, 7, 0.00443521094808668),
    (9, 8, 0.00008616131904608202),
    (9, 10, 0.000029517833129548022),
    (9, 11, 0.000762494536565196),
    (9, 12, 0.00003346306762915821),
    (9, 13, 0.00007681578987797783),
    (10, 1, 0.009322270880568405),
    (10, 2, 0.000020254746844599795),
    (10, 3, 0.00023500601357271062),
    (10, 4, 0.0013617773363115001),
    (10, 5, 0.000009083328382446275),
    (10, 6, 0.00001840239989943796),
    (10, 7, 0.000010781540651193795),
    (10, 8, 0.00002671767220453463),
    (10, 9, 0.000030520812178630785),
    (10, 11, 0.000031855778722983164),
    (10, 12, 0.0004215135278290673),
    (10, 13, 0.00006244122959858073),
    (11, 1, 0.00003363942481658124),
    (11, 2, 0.0000286721370679327),
    (11, 3, 0.0004917590531146349),
    (11, 4, 0.0018349257726532338),
    (11, 5, 0.000024763148915756672),
    (11, 6, 0.00010442346671132577),
    (11, 7, 0.000047054745823687904),
    (11, 8, 0.00038678542449209344),
    (11, 9, 0.00008411905126516441),
    (11, 10, 0.000026530805634556678),
    (11, 12, 0.00048041545797093287),
    (11, 13, 0.0010165654083166037),
    (12, 1, 0.012252953478055162),
    (12, 2, 0.000005131745225463936),
    (12, 3, 0.000008923671744409786),
    (12, 4, 0.0021122113111040983),
    (12, 5, 0.0000015164146296872908),
    (12, 6, 0.0008193443890555587),
    (12, 7, 0.0005300908848447211),
    (12, 8, 0.00012318614018410142),
    (12, 9, 0.001026882749503089),
    (12, 10, 0.000050966344544268),
    (12, 11, 0.004995221578124113),
    (12, 13, 0.000001358177454882406),
    (13, 1, 0.0006337791868513416),
    (13, 2, 0.0000009519790678842553),
    (13, 3, 0.000003302281817464143),
    (13, 4, 0.00148074982778491),
    (13, 5, 0.0000014964488140247861),
    (13, 6, 0.000005996316225352878),
    (13, 7, 0.0011227127562902584),
    (13, 8, 0.00018202700190020091),
    (13, 9, 0.000006003484178758085),
    (13, 10, 0.000007740675111283463),
    (13, 11, 0.0007356809260771047),
    (13, 12, 0.000005987140187701364),
];

/*
Small script to parse text formatted prometheus table data

peer1 peer2 value
peer1 peer3 value
peer2 peer1 value
...


import sys

"""
LATENCY

sum by (ic_node,peer) (quic_transport_quinn_path_rtt_seconds{ic_subnet="<<SUBNET_ID>>"})

PACKETLOSS

sum by (ic_node,peer) (
  rate(quic_transport_quinn_path_lost_packets{ic_subnet="<<SUBNET_ID>>"}[10m]) /
  rate(quic_transport_quinn_path_sent_packets{ic_subnet="<<SUBNET_ID>>"}[10m])
)

"""

def process_data(input_file, output_file):
    # Initialize a dictionary to hold ID to number mapping
    id_to_number = {}
    next_number = 1

    # Read data from the input file
    with open(input_file, 'r') as file:
        data = file.readlines()

    # Prepare to write to the output file
    with open(output_file, 'w') as output:
        # Process each line
        for line in data:
            # Split the line into components
            parts = line.split()
            if len(parts) < 3:
                continue

            node_id, peer_id, value = parts[0], parts[1], parts[2]

            # Assign numbers to node IDs if they haven't been assigned already
            if node_id not in id_to_number:
                id_to_number[node_id] = next_number
                next_number += 1
            if peer_id not in id_to_number:
                id_to_number[peer_id] = next_number
                next_number += 1

            # Map node and peer IDs to their respective numbers
            node_number = id_to_number[node_id]
            peer_number = id_to_number[peer_id]

            # Format the output
            output_line = f"({node_number}, {peer_number}, {value}),\n"
            output.write(output_line)

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python process_data.py <input_file> <output_file>")
    else:
        input_file = sys.argv[1]
        output_file = sys.argv[2]
        process_data(input_file, output_file)
*/
